<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结算中心 - 小兔鲜儿</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/checkout.css">
</head>

<body>
    <!-- 顶部导航栏 -->
    <div class="top-nav">
        <div class="container">
            <a href="index.html" class="top-link">返回首页</a>
            <span class="separator">|</span>
            <a href="index.html" class="top-link">继续购物</a>
            <span class="separator">|</span>
            <span id="user-status-display">
                <span id="checkout-user-status" class="user-status">
                    <a href="javascript:void(0)" id="checkout-login-link" class="user-link">登录</a>
                    <span class="separator">/</span>
                    <a href="javascript:void(0)" id="checkout-register-link" class="user-link">注册</a>
                </span>
                <span id="checkout-logged-in-user" class="logged-in-user" style="display: none;">
                    <span class="welcome-text">欢迎, <span id="checkout-username-display"></span></span>
                    <a href="javascript:void(0)" id="checkout-logout-link" class="logout-link">退出</a>
                </span>
            </span>
        </div>
    </div>

    <!-- 结算头部 -->
    <header class="checkout-header">
        <div class="container">
            <a href="index.html"><img src="images/LOGO.PNG" class="logo" alt="小兔鲜儿"></a>
            <div class="checkout-steps">
                <div class="step active">
                    <span class="step-number">1</span>
                    <span class="step-text">确认订单</span>
                </div>
                <div class="step-line"></div>
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-text">付款</span>
                </div>
                <div class="step-line"></div>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-text">完成</span>
                </div>
            </div>
        </div>
    </header>

    <!-- 结算主体内容 -->
    <main class="checkout-container container">
        <div class="checkout-main">
            <!-- 收货地址 -->
            <section class="checkout-section shipping-address">
                <h2 class="section-title">收货地址</h2>
                <div class="address-list" id="address-list">
                    <!-- 地址将通过JS动态生成 -->
                    <div class="address-item empty-address">
                        <p>暂无收货地址</p>
                        <button class="btn-add-address" id="add-address-btn">+ 添加新地址</button>
                    </div>
                </div>
            </section>

            <!-- 商品清单 -->
            <section class="checkout-section order-items">
                <h2 class="section-title">商品清单</h2>
                <div class="order-list" id="order-list">
                    <!-- 商品将通过JS动态生成 -->
                    <div class="empty-order">
                        <p>购物车是空的</p>
                        <a href="index.html" class="btn-continue-shopping">继续购物</a>
                    </div>
                </div>
            </section>

            <!-- 配送方式 -->
            <section class="checkout-section shipping-method">
                <h2 class="section-title">配送方式</h2>
                <div class="shipping-options">
                    <div class="shipping-option active">
                        <input type="radio" name="shipping" id="shipping-standard" checked>
                        <label for="shipping-standard">
                            <span class="option-title">普通快递</span>
                            <span class="option-desc">预计2-5天送达</span>
                            <span class="option-price">¥8.00</span>
                        </label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" name="shipping" id="shipping-express">
                        <label for="shipping-express">
                            <span class="option-title">顺丰快递</span>
                            <span class="option-desc">预计1-2天送达</span>
                            <span class="option-price">¥15.00</span>
                        </label>
                    </div>
                </div>
            </section>

            <!-- 支付方式 -->
            <section class="checkout-section payment-method">
                <h2 class="section-title">支付方式</h2>
                <div class="payment-options">
                    <div class="payment-option active">
                        <input type="radio" name="payment" id="payment-wechat" checked>
                        <label for="payment-wechat">
                            <span class="payment-icon">💳</span>
                            <span class="option-title">微信支付</span>
                        </label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" name="payment" id="payment-alipay">
                        <label for="payment-alipay">
                            <span class="payment-icon">💰</span>
                            <span class="option-title">支付宝</span>
                        </label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" name="payment" id="payment-card">
                        <label for="payment-card">
                            <span class="payment-icon">🏦</span>
                            <span class="option-title">银行卡</span>
                        </label>
                    </div>
                </div>
            </section>

            <!-- 发票信息 -->
            <section class="checkout-section invoice-info">
                <h2 class="section-title">发票信息</h2>
                <div class="invoice-options">
                    <div class="invoice-option">
                        <input type="radio" name="invoice" id="invoice-no" checked>
                        <label for="invoice-no">不开发票</label>
                    </div>
                    <div class="invoice-option">
                        <input type="radio" name="invoice" id="invoice-personal">
                        <label for="invoice-personal">个人发票</label>
                    </div>
                    <div class="invoice-option">
                        <input type="radio" name="invoice" id="invoice-company">
                        <label for="invoice-company">公司发票</label>
                    </div>
                </div>
            </section>
        </div>

        <!-- 结算侧边栏 -->
        <aside class="checkout-sidebar">
            <div class="order-summary">
                <h3 class="summary-title">订单信息</h3>

                <div class="summary-row">
                    <span>商品金额</span>
                    <span id="summary-product-total">¥0.00</span>
                </div>
                <div class="summary-row">
                    <span>运费</span>
                    <span id="summary-shipping-fee">¥8.00</span>
                </div>
                <div class="summary-row">
                    <span>优惠</span>
                    <span id="summary-discount">-¥0.00</span>
                </div>

                <div class="summary-divider"></div>

                <div class="summary-row total">
                    <span>应付金额</span>
                    <span class="total-price" id="summary-total">¥0.00</span>
                </div>
                <div class="summary-actions">
                    <button class="clear-all-btn" id="clear-all-items">清空购物车</button>
                    <a href="index.html" class="continue-shopping-btn"
                        style="text-decoration: none; text-align: center;">继续购物</a>
                </div>
                <!-- 优惠券 -->
                <div class="coupon-section">
                    <div class="coupon-input">
                        <input type="text" id="coupon-code" placeholder="请输入优惠码">
                        <button id="apply-coupon">使用</button>
                    </div>
                    <div class="available-coupons">
                        <div class="coupon-item" data-code="WELCOME10" data-discount="10">
                            <span class="coupon-value">¥10</span>
                            <span class="coupon-desc">新人专享</span>
                        </div>
                        <div class="coupon-item" data-code="SAVE20" data-discount="20">
                            <span class="coupon-value">¥20</span>
                            <span class="coupon-desc">满199减20</span>
                        </div>
                    </div>
                </div>

                <!-- 提交订单 -->
                <div class="order-submit">
                    <button class="btn-submit-order" id="submit-order">提交订单</button>
                    <div id="login-required-hint" class="login-required-hint" style="display: none; margin-top: 10px;">
                        <p style="color: #ff6b6b; font-size: 14px; text-align: center;">
                            需要登录后才能提交订单
                        </p>
                    </div>

                    <p class="agreement-text">
                        点击"提交订单"即表示您已同意
                        <a href="#">《小兔鲜儿用户协议》</a>
                        和
                        <a href="#">《隐私政策》</a>
                    </p>
                </div>
            </div>
            </div>
        </aside>
    </main>

    <!-- 地址编辑模态框 -->
    <div id="address-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加收货地址</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="address-form">
                    <div class="form-group">
                        <label for="address-name">收货人</label>
                        <input type="text" id="address-name" required>
                    </div>
                    <div class="form-group">
                        <label for="address-phone">手机号码</label>
                        <input type="tel" id="address-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="address-region">所在地区</label>
                        <div class="region-selector">
                            <select id="address-province" required>
                                <option value="">选择省份</option>
                            </select>
                            <select id="address-city" required disabled>
                                <option value="">选择城市</option>
                            </select>
                            <select id="address-district" required disabled>
                                <option value="">选择区县</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address-detail">详细地址</label>
                        <input type="text" id="address-detail" placeholder="街道、小区、门牌号等" required>
                    </div>
                    <div class="form-group">
                        <label for="address-zip">邮政编码</label>
                        <input type="text" id="address-zip">
                    </div>
                    <div class="form-group checkbox">
                        <input type="checkbox" id="address-default">
                        <label for="address-default">设为默认地址</label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-save-address">保存地址</button>
                        <button type="button" class="btn-cancel-address">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 支付模态框 -->
    <div id="payment-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content payment-content">
            <div class="modal-header">
                <h3>请扫码支付</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="payment-qrcode">
                    <div class="qrcode-placeholder">
                        <div class="qrcode-img">📱</div>
                        <p>请使用微信/支付宝扫描二维码支付</p>
                    </div>
                </div>
                <div class="payment-info">
                    <div class="payment-amount">
                        <span>支付金额：</span>
                        <span class="amount" id="payment-amount">¥0.00</span>
                    </div>
                    <div class="payment-timer">
                        <span>支付剩余时间：</span>
                        <span class="timer" id="payment-timer">05:00</span>
                    </div>
                </div>
                <div class="payment-actions">
                    <button class="btn-payment-success" id="simulate-payment">模拟支付成功</button>
                    <button class="btn-payment-cancel">取消支付</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部版权 -->
    <div class="footer">
        <div class="wrapper">
            <div class="copyright">
                <p><a href="#">@李文杰 © 25216950212</a></p>
            </div>
        </div>
    </div>

    <!-- 模态框（复用） -->
    <div id="auth-modal" class="auth-modal" style="display: none;">
        <!-- 复用首页的登录/注册模态框 -->
    </div>

    <!-- 调试面板 -->
    <div id="debug-panel"
        style="position: fixed; bottom: 10px; right: 10px; background: white; padding: 10px; border: 1px solid #ccc; z-index: 9999;">
        <h4>地址管理器测试</h4>
        <button onclick="testAddressManager()">测试地址管理器</button>
        <button onclick="addTestAddress()">添加测试地址</button>
        <button onclick="clearAddresses()">清空地址</button>
        <div id="debug-output" style="margin-top: 10px; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
    </div>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/products-data.js"></script>
    <script src="js/cart-manager.js"></script>
    <script>
        // 确保全局对象存在
        window.CartManager = window.CartManager || {
            getCart: () => JSON.parse(localStorage.getItem('xiaotuxian_cart') || '[]'),
            updateCartCount: () => {
                const cart = JSON.parse(localStorage.getItem('xiaotuxian_cart') || '[]');
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.querySelectorAll('#cart-count, .cart-count').forEach(el => {
                    el.textContent = totalItems;
                    el.style.display = totalItems > 0 ? 'flex' : 'none';
                });
            }
        };
    </script>
    <script src="js/checkout.js"></script>
</body>

</html>